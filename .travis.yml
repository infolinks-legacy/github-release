language: generic
sudo: required
services:
  - docker

before_script:
  - docker login -u "${DOCKERHUB_USERNAME}" -p "${DOCKERHUB_PASSWORD}"
  - export IMAGE_TAG="$( [[ ${TRAVIS_TAG} =~ ^v[0-9]+$ ]] && echo ${TRAVIS_TAG} || echo ${TRAVIS_COMMIT} )"
script:
  - docker build -t infolinks/github-release:${IMAGE_TAG} .
  - docker push infolinks/github-release:${IMAGE_TAG}
  - |
    if [[ ${TRAVIS_TAG} =~ ^v[0-9]+$ ]]; then
      docker tag infolinks/github-release:${IMAGE_TAG} infolinks/github-release:latest
      docker push infolinks/github-release:latest
    fi
